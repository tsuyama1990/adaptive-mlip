# User Acceptance Testing (UAT) & Tutorial Master Plan

## 1. Tutorial Strategy

The primary mechanism for User Acceptance Testing (UAT) and user education will be a unified, executable **Marimo** notebook. This approach ensures that the "documentation" is always in sync with the code, as the tutorial *is* the integration test.

### 1.1. "Mock Mode" vs "Real Mode"
To make the tutorial executable in a Continuous Integration (CI) environment (where GPU resources and VASP licenses are unavailable), the system must support two execution modes, controlled by an environment variable (`PYACEMAKER_MODE`).

*   **Mock Mode (`PYACEMAKER_MODE=MOCK`):**
    *   **DFT:** Replaced by a `MockOracle` (Lennard-Jones potential) or a pre-calculated lookup table.
    *   **MACE/Pacemaker:** Training steps are simulated (1 epoch, minimal data) or bypassed using pre-generated dummy artifacts.
    *   **Speed:** Completes in < 2 minutes.
    *   **Purpose:** Verifies workflow logic, file I/O, and crash-safety.

*   **Real Mode (`PYACEMAKER_MODE=REAL`):**
    *   **DFT:** Calls actual VASP/QE executables.
    *   **MACE/Pacemaker:** Performs full training cycles.
    *   **Speed:** Takes hours/days.
    *   **Purpose:** Scientific validation and reproduction of results.

## 2. Tutorial Plan: `tutorials/UAT_AND_TUTORIAL.py`

A single file, `tutorials/UAT_AND_TUTORIAL.py`, will serve as the master scenario. It will guide the user through the 7-step "MACE Knowledge Distillation" pipeline applied to a standard test case: **The SN2 Reaction ($CH_3Cl + OH^-$)**.

### 2.1. Scenario Breakdown
The tutorial will include the following interactive cells:

1.  **Setup:** Import `pyacemaker`, check `PYACEMAKER_MODE`, and generate the `config.yaml`.
2.  **Step 1 (Direct Sampling):** Visualize the generated initial structures using `nglview` or `matplotlib` (projected PCA).
3.  **Step 2 (Active Learning):** Display the uncertainty distribution of the pool and highlight the selected active set.
4.  **Step 3 (MACE Fine-tuning):** Show the training loss curve (mocked or real).
5.  **Step 4 (Surrogate MD):** Visualize the MD trajectory generated by the fine-tuned MACE model.
6.  **Step 5-6 (Distillation):** Show the parity plot (Predicted vs. Surrogate Labels) for the base ACE model.
7.  **Step 7 (Delta Learning):** Compare the final ACE potential against the DFT ground truth for a Transition State calculation.

### 2.2. Artifact Verification
The tutorial script will programmatically assert the existence and validity of key output files:
*   `data/step1_initial.xyz`
*   `data/step2_active_set_labelled.xyz`
*   `models/mace_finetuned.model`
*   `data/step5_surrogate_labelled.xyz`
*   `models/final_potential.yace`

## 3. Tutorial Validation

The `UAT_AND_TUTORIAL.py` file will be executed as part of the CI pipeline.
Command:
```bash
export PYACEMAKER_MODE=MOCK
uv run marimo export html tutorials/UAT_AND_TUTORIAL.py -o site/tutorial.html
```
If this command fails, the build fails. This guarantees that the tutorial is always functional for new users.
